CCweb.model_plan=Backbone.Model.extend({defaults:{price:"...",productMap:null,dropdown:"YEAR",showVAT:!1,showTaxInfo:!1,enabled:!0,isTeam:!1,isEdu:!1,id:null},initialize:function(){this.updateTargetLanguage(),this.updateState(),this.updateVAT(),this.updateTaxInfo(),CCweb.models.currency.on("change:currency",this.onCurrencyChange,this),this.on("change:targetLanguage",this.onTargetLanguageChange),this.on("change:dropdown",this.onDropDownChange)},parse:function(e){return e.show?e:null},onCurrencyChange:function(){this.resetPrice(),this.updateTargetLanguage(),this.updateState(),this.updateVAT(),this.updateTaxInfo()},onTargetLanguageChange:function(){this.updatePriceDisplay()},onDropDownChange:function(){this.updatePriceDisplay(),this.updateState()},getAllProducts:function(){var e=[],t=this.get("productMap");return _.each(t,function(t){_.each(t,function(t){t&&e.push(t)})}),e},getProductsByTargetLanguage:function(){var e=[],t=this.get("productMap"),r=CCweb.util.defaultToEnglishOnlyProductCode(CCweb.models.currency.get("currency"))?"EN":"MULTI";return t&&t[r]&&_.each(t[r],function(t){t&&e.push(t)}),e},getSelectedProduct:function(){var e=this.get("productMap"),t=this.get("targetLanguage"),r=this.get("dropdown");return e&&e[t]&&e[t][r]?e[t][r]:null},getSelectedProductAsArray:function(){return $.makeArray(this.getSelectedProduct())},getSelectedProductCode:function(){var e,t=this.getSelectedProductAsArray();return t.length&&(e=t[0].purchaseProductCode),e},filterPurchaseProductKeys:function(e){var t=[];return _.each(e,function(e){t.push(e.purchaseProductCode)}),t},filterDigitalRiverProductKeys:function(e){var t=[];return _.each(e,function(e){e.digitalRiverProductCode&&t.push(e.digitalRiverProductCode)}),t},getDigitalRiverProductKeys:function(){return this.filterDigitalRiverProductKeys(this.getProductsByTargetLanguage())},getPurchaseProductKeys:function(){return this.filterPurchaseProductKeys(this.getProductsByTargetLanguage())},containsPurchaseProductKey:function(e){for(var t=this.filterPurchaseProductKeys(this.getAllProducts()),r=0;r<t.length;r++)if(t[r]===e)return!0;return!1},containsDigitalRiverProductKey:function(e){for(var t=this.filterDigitalRiverProductKeys(this.getAllProducts()),r=0;r<t.length;r++)if(t[r]==e)return!0;return!1},getUrl:function(){var e=this.get("button");if(e&&e.link)return e.link;var t=this.getSelectedProduct();return t&&t.link?t.link:null},getTrackingId:function(){var e=this.get("button");if(e&&e.trackingId)return e.trackingId;var t=this.getSelectedProduct();return t&&t.trackingId?t.trackingId:null},getSCJoinStep1Event:function(){var e=this.get("button");if(e&&e.scJoinStep1Id)return e.scJoinStep1Id;var t=this.getSelectedProduct();return t&&t.scJoinStep1Id?t.scJoinStep1Id:null},getSusiACValue:function(){var e=this.get("button");if(e&&e.susiACValue)return e.susiACValue;var t=this.getSelectedProduct();return t&&t.susiACValue?t.susiACValue:null},getSusiContextId:function(){var e=this.get("button");if(e&&e.susiContextId)return e.susiContextId;var t=this.getSelectedProduct();return t&&t.susiContextId?t.susiContextId:null},isCurrencySupported:function(e){if(CCweb.util.hasFeature("ccm_grand_gesture")&&"za"===e&&"grand_gesture_cs6"===this.get("id"))return!1;var t=CCweb.util.isDigitalRiverCustomer(e),r=this.getSelectedProduct(),i=r&&r.digitalRiverProductCode;return t&&!i?!1:!0},isFree:function(){return!this.has("productMap")},resetPrice:function(){this.isFree()||(this.set("annualPrepaidPrice",null),this.set("monthlyPrice",null),this.set("annualPrice",null),this.set("price",this.defaults.price))},updateTargetLanguage:function(){var e=this.get("productMap");CCweb.util.defaultToEnglishOnlyProductCode(CCweb.models.currency.get("currency"))&&e&&e.EN?this.set("targetLanguage","EN"):this.set("targetLanguage","MULTI")},updateState:function(){var e,t=!0,r=CCweb.models.currency.get("currency");if(CCweb.models.auth.isValid()&&CCweb.models.profile)e=CCweb.models.profile.get("countryCode").toLowerCase();else{var i=CCweb.util.getParam("store_code");!i||CCweb.util.hasFeature("ccm_bug_fix")&&!CCweb.util.isValidCountry(i)?CCweb.models.ip_profile.getValidCountryCode()&&(e=CCweb.models.ip_profile.getValidCountryCode().toLowerCase()):e=CCweb.util.hasFeature("ccm_bug_fix")?i.toLowerCase():"eu"===i.toLowerCase()?null:i.toLowerCase(),e&&CCweb.util.currencyMap[e]===r||(e=r)}"device_edu"===this.get("templateType")?CCweb.util.isDeviceLicensingPurchasingCountry(e)&&CCweb.util.isDeviceLicensingPurchasingCountry(r)||(t=!1):!this.get("isEdu")||CCweb.util.isEduPlanAvailable(e)&&CCweb.util.isEduPlanAvailable(r)||(t=!1),!this.get("isTeam")||CCweb.util.isTeamPlanAvailable(e)&&CCweb.util.isTeamPlanAvailable(r)||(t=!1),this.isCurrencySupported(e)||(t=!1),this.isFree()&&(t=!0),this.set("enabled",t)},updateVAT:function(){var e=CCweb.models.currency.get("currency");this.isCurrencySupported(e)&&CCweb.util.isVATCountry(e)?this.set("showVAT",!0):this.set("showVAT",!1)},updateTaxInfo:function(){var e=CCweb.models.currency.get("currency");"au"===e||"jp"===e?this.set("showTaxInfo",!0):this.set("showTaxInfo",!1)},updatePrice:function(e){var t=this.parseMonthlyPrice(e);t&&this.set("monthlyPrice",t);var r=this.parseAnnualPrice(e);r&&this.set("annualPrice",r);var i=this.parseAnnualPrepaidPrice(e);i&&this.set("annualPrepaidPrice",i),this.set("priceFormatString",e.formatString),this.updatePriceDisplay()},updatePriceDisplay:function(){var e=null;if(!this.isFree()){switch(this.get("dropdown")){case"YEAR":e=this.get("annualPrice");break;case"YEAR_PREPAID":e=this.get("annualPrepaidPrice");break;case"MONTH":e=this.get("monthlyPrice")}e?this.set("price",e):this.set("price","...")}},parseAnnualPrice:function(e){var t=CCweb.util.isVATCountry(CCweb.models.currency.get("currency")),r=this.get("isTeam");return t&&r?e.annualPriceWithoutTax:e.annualPriceWithTax},parseAnnualPrepaidPrice:function(e){var t=CCweb.util.isVATCountry(CCweb.models.currency.get("currency")),r=this.get("isTeam");return t&&r?e.annualPrepaidPriceWithoutTax:e.annualPrepaidPriceWithTax},parseMonthlyPrice:function(e){var t=CCweb.util.isVATCountry(CCweb.models.currency.get("currency")),r=this.get("isTeam");return t&&r?e.monthlyPriceWithoutTax:e.monthlyPriceWithTax}});