define(["underscore","backbone","config","utils"],function(t,e,a,o){var i=e.Model.extend({url:a("api")+"/profile/quota",defaults:{storage_quota:0,storage_used:0,storage_remaining:0},initialize:function(){t.bindAll(this,"fetchUpdates","convertToBytes","handleNotificationUpdate","handleUpdate","updateQuota");var e=this;CCweb.Notifications&&!o.hasFeature("temp_test_sharedcloud_api")?CCweb.Notifications.bind("profile:update",this.handleNotificationUpdate):require(["common/notifications"],function(t){t.on("quota",e.updateQuota)})},handleNotificationUpdate:function(t){"string"==typeof t.storage_quota&&"string"==typeof t.storage_used&&this.set({storage_quota:t.storage_quota*Math.pow(1024,3),storage_used:t.storage_used*Math.pow(1024,3),storage_remaining:(t.storage_quota-t.storage_used)*Math.pow(1024,3)})},parse:function(t){return t.storage_remaining_temp=parseFloat(t.storage_remaining),t.storage_quota=this.convertToBytes(t.normalized.storage_quota,t.normalized.storage_quota_units),t.storage_used=this.convertToBytes(Math.abs(t.normalized.storage_used),t.normalized.storage_used_units),t.storage_remaining=this.convertToBytes(t.normalized.storage_remaining,t.normalized.storage_remaining_units),t},updateQuota:function(t){this.set({storage_quota:Math.round(parseFloat(t.storage_quota,10)*Math.pow(1024,3)),storage_used:Math.round(parseFloat(t.storage_used,10)*Math.pow(1024,3)),storage_remaining:Math.round(parseFloat(t.storage_remaining,10)*Math.pow(1024,3))})},convertToBytes:function(e,a){var o=["KB","MB","GB","TB"],i=t.indexOf(o,a);return e*Math.pow(1024,i+1)},fetchUpdates:t.throttle(function(){this.fetch()},1e4),handleUpdate:function(t){"quota"==t.id&&this.fetchUpdates()}});return CCweb.model_quota=i,new i});