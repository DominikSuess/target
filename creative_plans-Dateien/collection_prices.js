CCweb.collection_prices=Backbone.Collection.extend({url:function(){return this.teamId?"/ccm-jil-api-v2/teams/"+this.teamId+"/subscription-offerings/"+this.offerId+"/pricing"+CCweb.util.getQueryParameters(this.queryParameters):"/ccm-jil-api-v2/subscription-offerings/"+this.offerId+"/pricing"+CCweb.util.getQueryParameters(this.queryParameters)},DEFAULT_PRICE_TABLE_SIZE:20,DEFAULT_PRICE_TABLE_INDEX:1,DEFAULT_GROW_THRESHOLD:10,apiQueryParameters:["country","marketSegment","priceTableIndex","priceTableSize","marketSegment","country"],initialize:function(e,i){i=i||{},this.model=CCweb.model_price,this.offerId=i.offerId,this.teamId=i.teamId,this.modelCountryPrice=i.modelCountryPrice,this.country=i.country,this.priceTableSize=i.priceTableSize=i.priceTableSize||this.DEFAULT_PRICE_TABLE_SIZE,i.priceTableIndex=i.priceTableIndex||this.DEFAULT_PRICE_TABLE_INDEX,this.queryParameters=CCweb.util.filteredExtend(i.queryParameters,this.apiQueryParameters,CCweb.util.filteredExtend(i,this.apiQueryParameters)),this.growThreshold=i.growThreshold||this.DEFAULT_GROW_THRESHOLD,this.sync=CCweb.jil_api.sync,this.priceCached=!1,this.priceAvailable=!0},comparator:function(e,i){return e.id<i.id?-1:e.id>i.id?1:0},isFetching:!1,fetch:function(e){return this.isFetching?void 0:(this.isFetching=!0,e=e||{},this.queryParameters=CCweb.util.filteredExtend(e,this.apiQueryParameters,this.queryParameters),e.self=this,e.userSuccess=e.success,e.success=function(e,i,r){r=r||{},r.self.hasFailedPriceApi=!1,r.self.isFetching=!1,r.self&&r.xhr&&203===r.xhr.status&&(r.self.priceCached=!0),r.userSuccess&&r.userSuccess(e,i,r)},e.userError=e.error,e.error=function(e,i,r){r=r||{},r.self.isFetching=!1,r.self.modelCountryPrice.collection.getOffer().setPricingFailure(),r.self&&(r.self.priceAvailable=!1),r.userError&&r.userError(e,i,r)},e.add=!0,e.remove=!1,Backbone.Collection.prototype.fetch.call(this,e))},parse:function(e,i){return i=i||{},e.countryPriceData?e.countryPriceData[0].priceList.price:e.priceList.price},getCurrency:function(){return this.modelCountryPrice.get("currency")},getCountry:function(){return this.country},getProductCode:function(){return this.modelCountryPrice.getProductCode()},getPrice:function(e){var i=this.get(e);if(i&&e>1){var r=e+this.growThreshold,t=Math.max(e-this.growThreshold,1);this.get(r)||this.fetchingHiPrices||(this.fetchingHiPrices=this.fetch({priceTableIndex:r,priceTableSize:this.priceTableSize,success:function(e){e.fetchingHiPrices=null},error:function(e){e.fetchingHiPrices=null}})),this.get(t)||this.fetchingLoPrices||(this.fetchingLoPrices=this.fetch({priceTableIndex:t,priceTableSize:this.priceTableSize,success:function(e){e.fetchingLoPrices=null},error:function(e){e.fetchingLoPrices=null}}))}else if(!i&&e>0){var s=Math.max(e-this.growThreshold,1),c=this.priceTableSize+this.growThreshold;this.fetch({priceTableIndex:s,priceTableSize:c})}return i}});