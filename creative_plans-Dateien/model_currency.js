CCweb.model_currency=Backbone.Model.extend({defaults:{showSmallPrice:!1},initialize:function(){this.updateCurrency(),this.on("change:currency",this.reset)},updateCurrency:function(){this.set("currency",this.getDefaultCurrency())},reset:function(){this.set("showSmallPrice",!1)},getDefaultCurrency:function(){var e,r,t=CCweb.util.getParam("store_code");if(CCweb.models.auth.isValid()&&CCweb.models.profile){if(r=CCweb.models.profile.get("countryCode"),r&&r.length>0&&(e=CCweb.util.currencyMap[r.toLowerCase()]))return e}else if(!t||CCweb.util.hasFeature("ccm_bug_fix")&&!CCweb.util.isValidCountry(t)){if(CCweb.models.ip_profile&&CCweb.models.ip_profile.getValidCountryCode()){if(r=CCweb.models.ip_profile.getValidCountryCode(),r&&r.length>0&&(e=CCweb.util.currencyMap[r.toLowerCase()]))return e}else if(CCweb.config.locale){var i=window.navigator.userLanguage||window.navigator.language;if(i=i.toLowerCase(),e=CCweb.util.localeCurrencyMap[i],e||(e=CCweb.util.currencyMap[i]),e||(e=CCweb.util.localeCurrencyMap[CCweb.config.locale]),e)return e}}else if(t=t.toLowerCase(),e=CCweb.util.currencyMap[t])return e;return"us"}});