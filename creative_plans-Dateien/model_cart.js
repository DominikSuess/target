CCweb.model_cart=Backbone.Model.extend({initialize:function(){this.set("items",new CCweb.collection_cart_items)},addItem:function(){},removeItem:function(){},removeAllItems:function(){this.get("items").reset()},isEmpty:function(){return this.get("items").isEmpty()},getJoinLink:function(){var t="";"edu"===this.get("type")?t="_edu":"offer"===this.get("type")&&(t="_offer");var e="";return"YEAR_PREPAID"===this.get("serviceCommitment")&&(e="/annual_pmt"),"/join/team"+t+e},getPlansTabId:function(){var t;return t="edu"===this.get("type")?"edu_inst":"team"}}),CCweb.model_cart_team=CCweb.model_cart.extend({defaults:_.extend({},CCweb.model_cart.prototype.defaults,{market:"COM",serviceCommitment:"YEAR",targetLanguage:null,maxUnitsPerProduct:250,totalLicenses:0,totalPriceWithoutTax:"0.00",totalPriceWithTax:null}),SERVICE_COMMITMENT:{YEAR:"YEAR",YEAR_PREPAID:"YEAR_PREPAID"},TARGET_LANGUAGE:{EN:"EN",MULTI:"MULTI"},initialize:function(t,e){e=e||{},this.get("items")||this.set("items",new CCweb.collection_cart_items_team);var i=this.get("country"),r=CCweb.util.currencyMap[i.toLowerCase()];this.set("currency",r);var a=this.get("targetLanguage");(!a||a===this.TARGET_LANGUAGE.EN&&!this.allowsEnSwitch())&&(CCweb.util.hasFeature("ccm_bug_fix")?this._setDefaultTargetLanguageForCurrency(r):this.set("targetLanguage",this._getDefaultTargetLanguageForCurrency(r)),this.get("items").clearCheckoutItems()),this.offers=e.subscriptionOffers||new CCweb.collection_subscription_offers([],{modelCode:"TEAM_DIRECT",country:i,languageCode:"MULTI"===this.get("targetLanguage")?"MULT":this.get("targetLanguage"),serviceCommitment:this.get("serviceCommitment"),tags:this._getTagForType(this.get("type")),marketSegment:this.get("market"),priceTableSize:20,priceTableIndex:1,sortOrder:"popularity"}),this.offers.on("sync",this._onSubscriptionOffersSync,this),this.get("items").on("add remove change:quantity change:subtotal",this._onItemsChange,this)},parse:function(t){return{country:t.country,items:new CCweb.collection_cart_items_team(t.items),market:t.market,serviceCommitment:t.serviceCommitment,targetLanguage:CCweb.util.hasFeature("ccm_bug_fix")?t.targetLanguageChanged?t.targetLanguage:this._getDefaultTargetLanguageForCurrency(CCweb.util.currencyMap[t.country.toLowerCase()]):t.targetLanguage,type:t.type}},addItem:function(t,e){var i=this.offers.getByProductCode(t);i&&this.get("items").add(new CCweb.model_cart_item_team({productCode:i.get("productCode"),quantity:e&&e>=0?e:1},{offer:i}))},removeItem:function(t){var e=this.get("items").find(function(e){return e.get("productCode")===t});e&&this.get("items").remove(e)},hasProduct:function(t){var e=this.get("items").find(function(e){return e.get("productCode")===t});return e?!0:!1},hasComplete:function(){return this.hasProduct("CCLE")},hasSingleApp:function(){var t=this.get("items"),e=t.find(function(t){return"CCLE"!==t.get("productCode")});return t.size()>0&&e?!0:!1},_getTagForType:function(t){var e;switch(t){case"offer":e="UPGRADE";break;case"edu":e="STE";break;default:e="REGULAR"}return e},switchCustomerType:function(t){t&&t!==this.get("type")&&(this.set("type",t),this.resetItemPrices(),this.offers.fetch({tags:this._getTagForType(this.get("type"))}))},_setDefaultTargetLanguageForCurrency:function(t){this.set("targetLanguageChanged",!1),this.set("targetLanguage",this._getDefaultTargetLanguageForCurrency(t))},_getDefaultTargetLanguageForCurrency:function(t){return CCweb.util.defaultToEnglishOnlyProductCode(t)?this.TARGET_LANGUAGE.EN:this.TARGET_LANGUAGE.MULTI},allowsEnSwitch:function(){var t=this.get("currency");return t&&CCweb.util.allowEnglishOnlyPurchase(t)},switchTargetLanguage:function(t){if(this.allowsEnSwitch()){var e;t===this.TARGET_LANGUAGE.EN?e=this.TARGET_LANGUAGE.EN:t===this.TARGET_LANGUAGE.MULTI&&(e=this.TARGET_LANGUAGE.MULTI),e&&e!==this.get("targetLanguage")&&(this.set("targetLanguage",e),this.resetItemPrices(),this.offers.fetch({languageCode:"MULTI"===this.get("targetLanguage")?"MULT":this.get("targetLanguage")})),CCweb.util.hasFeature("ccm_bug_fix")&&this.set("targetLanguageChanged",!0)}},isEnTargetLanguage:function(){return this.get("targetLanguage")===this.TARGET_LANGUAGE.EN},isMultiTargetLanguage:function(){return this.get("targetLanguage")===this.TARGET_LANGUAGE.MULTI},isYearServiceCommitment:function(){return this.get("serviceCommitment")===this.SERVICE_COMMITMENT.YEAR},isYearPrepaidServiceCommitment:function(){return this.get("serviceCommitment")===this.SERVICE_COMMITMENT.YEAR_PREPAID},switchServiceCommitment:function(t){var e;t===this.SERVICE_COMMITMENT.YEAR?e=this.SERVICE_COMMITMENT.YEAR:t===this.SERVICE_COMMITMENT.YEAR_PREPAID&&(e=this.SERVICE_COMMITMENT.YEAR_PREPAID),e&&e!==this.get("serviceCommitment")&&(this.set("serviceCommitment",e),this.resetItemPrices(),this.offers.fetch({serviceCommitment:this.get("serviceCommitment")}))},switchCountry:function(t){if(t&&this.get("country")!==t){this.set("country",t);var e=CCweb.util.currencyMap[t.toLowerCase()];this.set("currency",e),CCweb.util.hasFeature("ccm_bug_fix")?this._setDefaultTargetLanguageForCurrency(e):this.set("targetLanguage",this._getDefaultTargetLanguageForCurrency(e)),this.resetItemPrices(),this.offers.fetch({country:t,languageCode:"MULTI"===this.get("targetLanguage")?"MULT":this.get("targetLanguage")})}},resetItemPrices:function(){this.get("items").resetPrices()},getItemsForCheckout:function(){for(var t=this.get("items"),e=[],i=0;i<t.length;i++){var r=t.at(i),a=r.get("checkoutItem");if(!a)return null;e.push(a)}return e},getTermsName:function(){var t=this.isYearPrepaidServiceCommitment();return"EDU"===this.get("market")?t?"tc_ccm_team_edu_reg_pp":"tc_ccm_teamdir_edu_reg":"COM"===this.get("market")?"offer"===this.get("type")?t?"tc_ccm_team_com_offer_pp":"tc_ccm_teamdir_com_offer":t?"tc_ccm_team_com_reg_pp":"tc_ccm_teamdir_com_reg":""},_calculateTotalPrice:function(){var t=this.get("currencyFormatObject"),e=this.get("items").getTotalPriceWithoutTax();return!isNaN(e)&&t?CCweb.util.formatPrice(t.formatString,e,t.usePrecision,!0):"..."},_onItemsChange:function(){this.set("totalPriceWithoutTax",this._calculateTotalPrice())},_onSubscriptionOffersSync:function(t){var e=t.first();if(e){var i=e.getCurrency();this.set("currencyFormatObject",i)}this.get("items").updateOffers(t),this.set("totalPriceWithoutTax",this._calculateTotalPrice()),this.trigger("cartReady")}});