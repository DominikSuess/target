CCweb.collection_single_apps=Backbone.Collection.extend({initialize:function(){this.model=CCweb.model_single_app,CCweb.models.currency.on("change:currency",this.updatePrices,this),this.on("reset",this.updatePrices),this.reset(_.without(CCweb.singleApps,null),{parse:!0})},getPurchaseProductKeys:function(){var e=[];return _.each(this.models,function(t){e=_.union(e,t.getPurchaseProductKeys())}),_.uniq(e)},getDigitalRiverProductKeys:function(){var e=[];return _.each(this.models,function(t){e=_.union(e,t.getDigitalRiverProductKeys())}),_.uniq(e)},getAppsByPurchaseProductKey:function(e){return this.filter(function(t){return t.containsPurchaseProductKey(e)})},getAppsByDigitalRiverProductKey:function(e){return this.filter(function(t){return t.containsDigitalRiverProductKey(e)})},getAppByDisplayName:function(e){return this.filter(function(t){return t.get("displayName")===e})},getAppById:function(e){return this.filter(function(t){return t.get("id")===e})},updatePrices:function(){var e=CCweb.models.currency.get("currency"),t=CCweb.util.isDigitalRiverCustomer(e),i=CCweb.util.defaultToEnglishOnlyProductCode(e)?"EN":"MULTI",r=null;if(CCweb.models.auth.isValid())r=CCweb.models.profile.get("countryCode");else{var u=CCweb.util.getParam("store_code");r=!u||CCweb.util.hasFeature("ccm_bug_fix")&&!CCweb.util.isValidCountry(u)?CCweb.models.ip_profile.getValidCountryCode():CCweb.util.hasFeature("ccm_bug_fix")?u:"eu"===u.toLowerCase()?null:u}r&&CCweb.util.currencyMap[r.toLowerCase()]!==e&&(r=null);var n=t?this.getDigitalRiverProductKeys():this.getPurchaseProductKeys();if(n.length>0){var c=this;CCweb.util.getPriceForProducts({jsonpCallback:"PLANS_PRICES_SINGLE_"+e,productCodes:n,currency:e,countryCode:r?r:e,marketSegment:"COM",targetLanguage:i,success:function(i){if(CCweb.models.currency.get("currency")===e){var r=t?c.getAppsByDigitalRiverProductKey(i.productKey):c.getAppsByPurchaseProductKey(i.productKey);_.each(r,function(e){e.updatePrice(i)})}}})}}});