CCweb.collection_subscription_offers=Backbone.Collection.extend({url:function(){return this.teamId?"/ccm-jil-api-v2/teams/"+this.teamId+"/subscription-offerings"+CCweb.util.getQueryParameters(this.queryParameters):this.modelCode?"/ccm-jil-api-v2/subscription-offerings/"+this.modelCode+CCweb.util.getQueryParameters(this.queryParameters):void 0},DEFAULT_PRICE_TABLE_SIZE:10,DEFAULT_PRICE_TABLE_INDEX:1,apiQueryParameters:["country","languageCode","locale","productCode","channel","segmentationId","marketSegment","billingFrequency","priceTableSize","priceTableIndex","serviceCommitment","tags"],initialize:function(e,t){t=t||{},this.model=CCweb.model_subscription_offer,this.sync=CCweb.jil_api.sync,this.teamId=t.teamId,this.modelCode=t.modelCode,this.modelTeam=t.modelTeam,this.collectionSeats=t.collectionSeats,(!this.modelTeam||this.modelTeam.isDirect())&&(t.priceTableSize=t.priceTableSize||this.DEFAULT_PRICE_TABLE_SIZE,t.priceTableIndex=t.priceTableIndex||this.DEFAULT_PRICE_TABLE_INDEX),this.queryParameters=CCweb.util.filteredExtend(t,this.apiQueryParameters),!CCweb.util.hasFeature("temp_offer_error_handling")&&this.modelTeam&&this.modelTeam.isDirect()&&!this.modelTeam.isOrderProcessing()&&this.modelTeam.listenTo(this,"sync",this.modelTeam.listenForPricingSync),this.hasFailedPriceCall=!1,CCweb.util.hasFeature("temp_offer_error_handling")&&(this.hasBackEndDataMismatch=!1),this.collectionLocalizedProducts=new CCweb.collection_localized_products(this._collectionLocalizedProductsData),this.listenTo(this,"error pricecollection:error",this.onPricingError),this.sortOrder=t.sortOrder?t.sortOrder:"alphabetical",this.comparator="popularity"===this.sortOrder?this._popularityComparator:this._alphabeticalComparator},fetch:function(e){return e=e||{},e.reset=!0,this.queryParameters=CCweb.util.filteredExtend(e,this.apiQueryParameters,this.queryParameters),this.teamId=e.teamId||this.teamId,this.modelCode=e.modelCode||this.modelCode,CCweb.util.hasFeature("temp_offer_error_handling")&&_.extend(e,{userSuccess:e.success,userError:e.error,success:this.onSubscriptionFetchResult,error:this.onSubscriptionFetchResult,self:this}),e.queryParameters=this.queryParameters,e.teamId=this.teamId,e.modelCode=this.modelCode,this.currentFetchjqXHR&&this.currentFetchjqXHR.abort(),this.currentFetchjqXHR=Backbone.Collection.prototype.fetch.call(this,e),this.currentFetchjqXHR},onSubscriptionFetchResult:CCweb.util.hasFeature("temp_offer_error_handling")?function(e,t,i){i.self.subscriptionAPIStatus=i.xhr.status,i.self.fetchFailed=200!==i.xhr.status,i.self.hasBackEndDataMismatch=409===i.xhr.status||502===i.xhr.status,i.self.fetchFailed?i.userError&&i.userError(e,t,i):i.userSuccess&&i.userSuccess(e,t,i)}:void 0,parse:function(e,t){return t.teamId=this.teamId,_.each(e.subscriptionOffers,function(e){e.material&&e.material.data&&e.material.data.localizedData&&e.material.data.localizedData.length>0&&(e.material.data.localizedData[0].name=this.collectionLocalizedProducts.getLocalizedProductName(e.productCode),e.material.data.localizedData[0].description=this.collectionLocalizedProducts.getLocalizedProductDescription(e.productCode))},this),e.subscriptionOffers},getOfferByProductCode:function(e){return this.findWhere({productCode:e})},getProductsAvailableForPurchase:function(){return this.map(function(e){return{offerId:e.id,productCode:e.get("productCode"),productName:e.getLocalizedProductName(),countryCode:e.getCountryCode(),businessSegment:e.get("businessSegment"),sellableSKU:e.getSKU()}})},_alphabeticalComparator:function(e,t){var i,r;if("CCLE"===e.get("productCode"))return-1;if("CCLE"===t.get("productCode"))return 1;try{i=e.get("material").data.name,r=t.get("material").data.name}catch(o){return 0}return r>i?-1:i>r?1:0},_popularitySortOrder:["CCLE","PHSP","ILST","IDSN","MUSE","DRWV","FLPR","PPRO","AEFT","AUDT","AICY"],_popularityComparator:function(e,t){var i=this._popularitySortOrder.indexOf(e.get("productCode")),r=this._popularitySortOrder.indexOf(t.get("productCode"));if(-1===i&&-1===r){var o=e.getLocalizedProductName(),a=t.getLocalizedProductName();return a>o?-1:o>a?1:0}return-1===i||-1===r?-1===i?1:-1:r>i?-1:i>r?1:0},calculateNextBillingAmount:function(e,t){if(0===this.length||this.hasFailedPriceCall)return void 0;var i=!0,r=[];return this.each(function(o){var a=0;if(t||(a=this.collectionSeats.getNumSeatsAtNextBilling(o.get("productCode"))),e){var c=e.get(o.get("productCode"));c&&(a+=c.get("quantity"))}if(a){var s=o.getPrice(a);s||(i=!1),r.push(s)}},this),i?new CCweb.model_next_billing_price({models:r},{subscriptionOffers:this}):void 0},getByProductCode:function(e){return this.find(function(t){return t.get("productCode")===e})},getProductNameForProductCode:function(e){var t,i=this.getByProductCode(e);return CCweb.util.hasFeature("temp_jil_v2")?(t=_.findWhere(this._collectionLocalizedProductsData,{productCode:e}),i&&i.getLocalizedProductName()?i.getLocalizedProductName():t&&t.name?t.name:this.modelTeam.isIndirect()&&this._oldProductsOffers[e]?this._oldProductsOffers[e]:""):i?i.getLocalizedProductName():(t=_.findWhere(this._collectionLocalizedProductsData,{productCode:e}),t?t.name:"")},isRetiredProductCode:function(e){return _.has(this._oldProductsOffers,e)},onPricingError:function(){this.hasFailedPriceCall=!0},getCCCompleteOffers:function(){return this.filter(function(e){return e.has("productCode")?"CCLE"===e.get("productCode"):!1})},getPointProductOffers:function(){return this.filter(function(e){return e.has("productCode")?"CCLE"!==e.get("productCode"):!1})},getCurrency:function(){return!this.isEmpty()&&this.first().getPriceCollection()?this.first().getPriceCollection().getCurrency():void 0},getCountry:function(){return!this.isEmpty()&&this.first().getPriceCollection()?this.first().getPriceCollection().getCountry():void 0},_collectionLocalizedProductsData:[{productCode:"ACRO",name:CCweb.util.loc("Acrobat Standard"),description:null},{productCode:"APAP",name:CCweb.util.loc("Acrobat Pro"),description:null},{productCode:"AEFT",name:CCweb.util.loc("After Effects CC"),description:CCweb.util.loc("Cinematic visual effects and motion graphics.")},{productCode:"AICY",name:CCweb.util.loc("InCopy CC"),description:CCweb.util.loc("Collaborate in demanding editorial workflows.")},{productCode:"AUDT",name:CCweb.util.loc("Adobe Audition CC"),description:CCweb.util.loc("Sound your best.")},{productCode:"CCLE",name:CCweb.util.loc("Creative Cloud - Complete"),description:CCweb.util.loc("Everything you need to create anything.")},{productCode:"DRWV",name:CCweb.util.loc("Dreamweaver CC"),description:CCweb.util.loc("Website and mobile app design.")},{productCode:"FLPR",name:CCweb.util.loc("Flash Professional CC"),description:CCweb.util.loc("Interactive experiences, game design, and mobile device packaging.")},{productCode:"IDSN",name:CCweb.util.loc("InDesign CC"),description:CCweb.util.loc("Page design, layout, and publishing.")},{productCode:"ILST",name:CCweb.util.loc("Illustrator CC"),description:CCweb.util.loc("Vector graphics and illustration.")},{productCode:"MUSE",name:CCweb.util.loc("Adobe Muse CC"),description:CCweb.util.loc("Website design without coding.")},{productCode:"PHSP",name:CCweb.util.loc("Photoshop CC"),description:CCweb.util.loc("Image editing and compositing.")},{productCode:"PPRO",name:CCweb.util.loc("Premiere Pro CC"),description:CCweb.util.loc("Video production and editing.")}],_oldProductsOffers:CCweb.util.hasFeature("temp_jil_v2")?{EDGE:"Edge Animate",PRLD:"Prelude",SHDW:"Edge Inspect",SPGD:"SpeedGrade"}:void 0});