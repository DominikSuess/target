CCweb.view_tabs=Backbone.View.extend({initialize:function(e){this.collectionTabs=e.collectionTabs,this.collectionPlans=e.collectionPlans,this.childViews=[],_.bindAll(this,"render","tabClicked","showTab","onClose"),this.template=_.template('<div class="plans_tabs_container"><div class="plans_tabs_sub_container"><ul /></div></div><div class="plans_tabs_contents" />'),this.collectionPlans.on("reset",this.render),CCweb.util.hasFeature("enable_tt_mbox")&&CCweb.models.currency.on("change:currency",this.onCurrencyChange,this)},render:function(){this.$el.empty().append(this.template()),this.panels={},this.tabs={};var e=this;this.collectionTabs.each(function(t){var a=CCweb.view_tab_factory.create(t);a.on("tab_clicked",e.tabClicked),e.$(".plans_tabs_container ul").append(a.render().$el),e.childViews.push(a);var n=CCweb.view_tab_panel_factory.create(t,e.collectionPlans);e.$(".plans_tabs_contents").append(n.render().$el),e.childViews.push(n),e.tabs[t.get("id")]=a,e.panels[t.get("id")]=n});var t=CCweb.util.getParam("plan"),a="individual";CCweb.util.hasFeature("enable_tt_mbox")&&this.$el.append('<div id="plans-tab-mbox"/>');var n=t?this.showTab(t)?this.panels[t]:null:null;return n||(this.showTab(a),n=this.panels[a]),t&&"team"===t||_.defer(function(){n.adjustHeights(20,100)},0),this},tabClicked:function(e){return this.showTab(e,!0),!1},showTab:function(e,t){var a=this.tabs[e],n=this.panels[e];if(t=t||!1,a&&n){this.$(".plans_tabs_container ul li").removeClass("selected"),a.$el.addClass("selected");var s=this;if(this.$(".plans_tabs_contents .tab_panel").animate({opacity:0},200,_.once(function(){s.$(".plans_tabs_contents .tab_panel").hide().css("opacity",1);var t=n.$el.css("opacity",0).show();"team"===e?n.adjustBannerHeight():n.adjustHeights(),t.animate({opacity:1},200)})),CCweb.util.hasFeature("enable_tt_mbox")){this.activeTabID=e;var i=this.getTabMboxParams(this.activeTabID);this.defineMboxTab(i),this.updateMboxTab(i)}return CCweb.LpChatPod.setLineOfBusiness(a.model.get("lpUnitVal"),a.model.get("lpPID"),t),!0}return!1},onCurrencyChange:function(){if(this.activeTabID){var e=this.getTabMboxParams(this.activeTabID);this.defineMboxTab(e),this.updateMboxTab(e)}},onClose:function(){this.collectionPlans.off("reset",this.render),_.each(this.childViews,function(e){e.off("tab_clicked"),e.close()}),this.childViews.length=0},getTabMboxParams:function(e){return CCweb.models.currency=CCweb.models.currency||new CCweb.model_currency,{page:"plans",sLang:CCweb.config.locale,overrideLanguage:CCweb.config.locale,currency:CCweb.models.currency.get("currency"),targetedTab:e,authenticatedStats:null,ccmPlanType:null}},mboxDefined:!1,defineMboxTab:function(e){var t=("prod"!==CCweb.config.ccm_env?"stage_":"")+"ccm_mbox_dynamic_tab";this.mboxDefined||(CCweb.TT.mboxDefine({htmlClass:"plans-tab-mbox",mboxName:t,params:e}),this.mboxDefined=!0)},updateMboxTab:function(e){var t=("prod"!==CCweb.config.ccm_env?"stage_":"")+"ccm_mbox_dynamic_tab";CCweb.TT.mboxUpdate({mboxName:t,params:e})}});