define(["jquery","config","underscore","authModel","common/utils/logAjaxDuration"],function(t,e,o,r,n){var i=o.extend({},Backbone.Events),a=!1,u=3,s=0,d=null,c=null,l=function(t){t=t||{},s=0;var e=t.quota||{},r=t.move||[],n=t.invites||[],a=t.sharedCloud||[],u=t.empty_archive||[];if(a.length>0&&i.trigger("resources",a),n.length>0&&i.trigger("invites",n),o.isEmpty(e)||i.trigger("quota",e),r.length>0&&i.trigger("move",r),u.length>0){var d;o.each(u,function(t){d="complete"===d?d:t.status}),i.trigger("empty_archive",d)}},g=function(t,e){return a=!1,s++,"abort"!=e&&503!==t.status?401===t.status?void(r&&r.signOut()):void(u>=s&&i.start()):void 0},h=o.debounce(function(){a&&(d=t.ajax({type:"GET",url:e("sharedcloud_proxy_url")+"/notifications",headers:{Authorization:r.get("requestHeaderToken")},data:{registrationId:c},timeout:2e5}).always(n("sharedcloud-proxy.route.getnotifications")).fail(g).done(l).done(h))},2500);return i.start=o.debounce(function(){t.ajax({type:"POST",contentType:"application/json",url:e("sharedcloud_proxy_url")+"/notifications",headers:{Authorization:r.get("requestHeaderToken")}}).done(function(t){return t.registrationId?(s=0,c=t.registrationId,void h()):(s++,void(u>=s&&i.start()))}).always(n("sharedcloud-proxy.route.postnotifications")),a=!0},2500),i.stop=function(){a=!1,d&&d.abort&&d.abort()},i});