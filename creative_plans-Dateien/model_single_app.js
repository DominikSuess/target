CCweb.model_single_app=Backbone.Model.extend({defaults:{price:"...",dropdown:"YEAR",vatIncluded:!0,showVAT:!1},initialize:function(){this.updateTargetLanguage(),this.updateVAT(),this.updateTaxInfo(),CCweb.models.currency.on("change:currency",this.onCurrencyChange,this),this.on("change:dropdown",this.onDropDownChange),this.on("change:targetLanguage",this.onTargetLanguageChange)},parse:function(e){return e.show?e:null},onCurrencyChange:function(){this.resetPrice(),this.updateTargetLanguage(),this.updateVAT(),this.updateTaxInfo()},onTargetLanguageChange:function(){this.updatePriceDisplay()},onDropDownChange:function(){this.updatePriceDisplay()},getAllProducts:function(){var e=[],t=this.get("productMap");return _.each(t,function(t){_.each(t,function(t){t&&e.push(t)})}),e},getProductsByTargetLanguage:function(){var e=[],t=this.get("productMap"),r=CCweb.util.defaultToEnglishOnlyProductCode(CCweb.models.currency.get("currency"))?"EN":"MULTI";return t&&t[r]&&_.each(t[r],function(t){t&&e.push(t)}),e},getSelectedProduct:function(){var e=this.get("productMap"),t=this.get("targetLanguage"),r=this.get("dropdown");return e&&e[t]&&e[t][r]?e[t][r]:null},filterPurchaseProductKeys:function(e){var t=[];return _.each(e,function(e){t.push(e.purchaseProductCode)}),t},filterDigitalRiverProductKeys:function(e){var t=[];return _.each(e,function(e){t.push(e.digitalRiverProductCode)}),t},getDigitalRiverProductKeys:function(){return this.filterDigitalRiverProductKeys(this.getProductsByTargetLanguage())},getPurchaseProductKeys:function(){return this.filterPurchaseProductKeys(this.getProductsByTargetLanguage())},containsPurchaseProductKey:function(e){for(var t=this.filterPurchaseProductKeys(this.getAllProducts()),r=0;r<t.length;r++)if(t[r]===e)return!0;return!1},containsDigitalRiverProductKey:function(e){for(var t=this.filterDigitalRiverProductKeys(this.getAllProducts()),r=0;r<t.length;r++)if(t[r]==e)return!0;return!1},getUrl:function(){var e=this.getSelectedProduct();return e&&e.link?e.link:null},getSCJoinStep1Event:function(){return"join:single_app_signin_page_loaded"},getSusiACValue:function(){var e=this.getSelectedProduct();return e&&e.susiACValue?e.susiACValue:null},getSusiContextId:function(){var e=this.get("susiContextId");return e?e:null},resetPrice:function(){this.set("annualPrepaidPrice",null),this.set("ggPrice",null),this.set("monthlyPrice",null),this.set("annualPrice",null),this.set("price","...")},updateVAT:function(){CCweb.util.isVATCountry(CCweb.models.currency.get("currency"))?this.set("showVAT",!0):this.set("showVAT",!1)},updateTaxInfo:function(){var e=CCweb.models.currency.get("currency");"au"===e||"jp"===e?this.set("showTaxInfo",!0):this.set("showTaxInfo",!1)},updateTargetLanguage:function(){CCweb.util.defaultToEnglishOnlyProductCode(CCweb.models.currency.get("currency"))?this.set("targetLanguage","EN"):this.set("targetLanguage","MULTI")},isGrandGesture:function(e){var t=!1;if(e&&e.productKey){var r=this.get("productMap"),n=this.get("targetLanguage");t=r&&r[n]&&r[n].GRAND_GESTURE&&(r[n].GRAND_GESTURE.purchaseProductCode==e.productKey||r[n].GRAND_GESTURE.digitalRiverProductCode==e.productKey)}return t},updatePrice:function(e){if(this.isGrandGesture(e)){var t=this.parseGrandGesturePrice(e);t&&this.set("ggPrice",t)}else{var r=this.parseMonthlyPrice(e);r&&this.set("monthlyPrice",r);var n=this.parseAnnualPrice(e);n&&this.set("annualPrice",n);var i=this.parseAnnualPrepaidPrice(e);i&&this.set("annualPrepaidPrice",i)}this.set("priceFormatString",e.formatString),this.updatePriceDisplay()},updatePriceDisplay:function(){var e=null;switch(this.get("dropdown")){case"YEAR":e=this.get("annualPrice");break;case"YEAR_PREPAID":e=this.get("annualPrepaidPrice");break;case"MONTH":e=this.get("monthlyPrice");break;case"GRAND_GESTURE":e=this.get("ggPrice")}e?this.set("price",e):this.set("price","...")},parseAnnualPrice:function(e){return e.annualPriceWithTax},parseAnnualPrepaidPrice:function(e){return e.annualPrepaidPriceWithTax||0},parseMonthlyPrice:function(e){return e.monthlyPriceWithTax},parseGrandGesturePrice:function(e){return e.annualPriceWithTax},getTrackingId:function(){var e=this.get("dropdown");return"MONTH"===e?"plans:single_app_month_join_click":"YEAR"===e?"plans:single_app_year_join_click":"YEAR_PREPAID"===e?"plans:single_app_year_prepaid_join_click":null}});